
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model User {
  id          Int         @id @default(autoincrement())
  name        String
  email       String 
  passowrd    String
  role        String
  createdAt   DateTime    @default(now()) @map("created_at")

  contests        Contest[]
  mcqSubmissions  McqSubmission[]
  dsaSubmissions  DsaSubmission[]

  @@map("users") 

}

model Contest{
  id     Int     @id @default(autoincrement())
  title   String
  description   String
  creatorId      Int 
  startTime    DateTime   @map("creator_id")
  endTime      DateTime   @map("start_time")
  createdAt    DateTime   @default(now()) @map("created_at")

  creator User    @relation(fields: [creatorId], references: [id])
  mcqs            McqQuestion[]
  dsaProblems     DsaProblem[]
  @@map("contests")
}

model McqQuestion {
  id                 Int             @id @default(autoincrement())
  contestId          Int             @map("contest_id") // Links to Contest
  questionText       String          @map("question_text")
  options            Json            // Stores array like ["A", "B", "C", "D"]
  correctOptionIndex Int             @map("correct_option_index") // 0, 1, 2, or 3
  points             Int             @default(1)
  createdAt          DateTime        @default(now()) @map("created_at")

  // Relations
  contest            Contest         @relation(fields: [contestId], references: [id])
  submissions        McqSubmission[]

  @@map("mcq_questions")
}



model DsaProblem {

  id               Int       @id @default(autoincrement())
  contestId        Int       @map("contest_id")
  title            String
  description      String
  tags             Json
  points           Int       @default(100)
  timeLimit        Int       @default(2000) @map("time_limit")
  memoryLimit      Int       @default(256) @map("memory_limit")
  createdAt        DateTime  @default(now()) @map("created_at")

  contest          Contest    @relation(fields: [contestId], references: [id])
  testCases        TestCase[]
  submissions      DsaSubmission[]

  @@map("dsa_problems")
}

model TestCase {
  id              Int         @id @default(autoincrement())
  problemId       Int         @map("problen_id")
  input           String
  expectedOutput  String      @map("expected_output")
  isHidden        Boolean     @default(false) @map("is_hidden")


  problem          DsaProblem   @relation(fields: [problemId], references: [id])

  @@map("test_cases")

}

model McqSubmission{
  id                   Int          @id @default(autoincrement())
  userId               Int          @map("user_id")
  questionId           Int          @map("question_id")
  selectedOptionIndex  Int          @map("slected_option_index")
  isCorrect            Boolean      @map("is_correct")
  pointsEarned         Int          @default(0) @map("points_earned")
  submittedAt          DateTime     @default(now()) @map("submitted_at")


  user                  User         @relation(fields: [userId], references: [id])
  question              McqQuestion  @relation(fields: [questionId],references: [id])

  @@unique([userId,questionId])
  @@map("mcq_submissions")
  
}

model DsaSubmission{
  id              Int        @id @default(autoincrement())
  userId          Int        @map("user_Id")
  problemId       Int        @map("problem_id")
  code            String     
  language        String      @db.VarChar(50)
  status          String      @db.VarChar(50)
  pointsEarned    Int         @default(0) @map("points_earned")
  testCasesPassed Int         @default(0) @map("total_test_passed")
  totalTestCases  Int         @default(0) @map("total_test cases")
  exxecutionTime   Int?       @map("execution_time")
  submittedAt      DateTime   @default(now()) @map("submitted_at")

  user            User       @relation(fields: [userId], references: [id])
  problem         DsaProblem @relation(fields: [problemId], references: [id])
}






 